<script>

  /**
   * Run initializations on page load.
   */
   window.onload = function() {
     initialize();
   };

   window.onbeforeunload = function () {
     // TODO: get this to work. For now use Exit button.
     leaving();
     return null;
   };

  function initialize() {
      // Read from gameTables and show the current people in the room.
      // Create a timer so this updates every few seconds/

      google.script.run
        .withSuccessHandler(populatePlayersList)
        .withFailureHandler(showError)
        .getPlayers();

      document.querySelector("#exitButton").addEventListener("click", function(){
          leaving();
      });

      // get the current list of available players (there will be either 1 or 0)
      // If 1, then start the game immediately and remove that 1 player from the available players table
      // else if 0, wait for opponent

      // Once we have 2 players the game starts
  }

  /**
   * @param supportedLocales an array of supported languages based on what is in the configured messages sheet.
   */
  function populatePlayersList(players) {
    const container = document.querySelector("#players");
    removeChildren(container);

    for (var i = 0; i < players.length; i++) {
      const playerLi = document.createElement("li");
      playerLi.textContent = players[i];
      container.appendChild(playerLi);
    }
  }

  function leaving() {
      google.script.run
        .withSuccessHandler(playerRemoved)
        .withFailureHandler(showError)
        .removePlayer();
  }

  function playerRemoved() {
    alert("removed user");
  }

</script>
