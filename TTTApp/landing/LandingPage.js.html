<script>

  /**
   * Run initializations on page load.
   */
   window.onload = function() {
     initialize();
   };

   window.onbeforeunload = function () {
     return "are you sure you want to leave?";
   };


   function initialize() {
     initializeButtons();
     continuouslyShowCurrentPlayers();
  }

  function initializeButtons() {

    getPlayButton().addEventListener("click", function(){
       enterGame();
     });

    const quitButton = getQuitButton();
    quitButton.disabled = true;
    quitButton.addEventListener("click", function(){
      leaveGame();
    });
  }

  function continuouslyShowCurrentPlayers() {
      showCurrentPlayers();
      setTimeout(continuouslyShowCurrentPlayers, 1000);
  }

  function showCurrentPlayers() {
    google.script.run
        .withSuccessHandler(populatePlayersList)
        .withFailureHandler(showError)
        .getPlayers();
  }

  /**
   * @param players list of currently available or active players.
   */
  function populatePlayersList(players) {
    const container = document.querySelector("#players");
    removeChildren(container);

    for (var i = 0; i < players.length; i++) {
      const playerLi = document.createElement("li");
      playerLi.textContent = players[i];
      container.appendChild(playerLi);
    }
  }

  function enterGame() {

      google.script.run
        .withFailureHandler(showError)
        .newPlayerEnters();

      google.script.run
        .withSuccessHandler(populatePlayersList)
        .withFailureHandler(showError)
        .enterCurrentPlayer();

      getPlayButton().disabled = true;
      getQuitButton().disabled = false;

      // get the current list of available players (there will be either 1 or 0)
      // If 1, then start the game immediately and remove that 1 player from the available players table
      // else if 0, wait for opponent

      // Once we have 2 players the game starts
  }

  function leaveGame() {
      google.script.run
        .withFailureHandler(showError)
        .removePlayer();

      getPlayButton().disabled = false;
      getQuitButton().disabled = true;
  }

  function getPlayButton() {
    return document.querySelector("#play");
  }

  function getQuitButton() {
    return document.querySelector("#quit");
  }

</script>
